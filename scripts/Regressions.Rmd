---
title: "Regressions"
author: "Alejandra Garcia Isaza"
date: '2022-07-12'
output: html_document
---

Diss Research questions:

1. Can both structural and relational components of family-school connections be identified using exploratory factor analysis approaches in the Conexiones parents’ assessment data? --> addressed with Exploratory Factor Analyses, not included here.
    
    I identified *15 predictors* in the EFA part of my study. They are different parent engagement practices, some are considered structural     and some are considered relational ("hwi_1"    "hwi_2"    "hwi_3"      "monit"    "str_home" "convos_1" "convos_2" "convos_3" "sbi_1"        "sbi_2"    "belong"  "endorse"  "value_ed" "rel_1"    "rel_2" )
    
    The *outcome* is youth engagement (called "engage")
    
    The *covariates* are parent's educational level (q36_hv1) and parent's comfort with ENG (q173_3_p1)
    

2. What specific structural and relational components of family-school connections in the Conexiones parents’ assessment data are significantly and positively associated with positive students’ school engagement? --> to be addressed with simple linear regression models


3. What model best predicts positive students’ school engagement, a structural components only model or a combined structural plus relational components model? --> to be addressed with a step-wise multiple linear regression model, with predictor blocks

     demo vars: if effects hold when demo vars included... 
     
     model 1a: what is the univar association of each predictor with the outcome (15 models)
     model 1b: what is the multivar assicition of each predictor with th outcome adjusting for demo charcs (covariates) (15 models)
     
     model 2a: what is the multivar effect of the structural predictors with th outcome (1 model, 10 composire scores simultaneously)
     model 2b: what is the multivar effect of the structural predictors with th outcome adjusting for demo charcr (1 model, 10 composite scores simultaneously + demo vars: block 1 demos, block 2: structural (10 scores))
     
     model 3a: what is the multivar effect of the relational predictors with th outcome (1 model, 5 composite scores simultaneously)
     model 3b: what is the multivar effect of the relational predictors with th outcome adjusting for demo charcr (1 model, 5 composite scores simultaneously + demo vars: block 1 demos, block 2: relational (5 scores))
     
     model 4a: what is the multivar effect of structural and relational predictors on the outcome (1 model,  15 scores simultaneosuly)
     model 4b: what is the multivar effect of structural and relational predictors on the outcome adjusting for demo charcr (1 model,  15 scores simultaneosuly + demo vars: block 1 demos, block 2: structural + block 3: relational; if RQ changes and is that interest is above and beyond structural)
     
     moderation
     
     Ed. level: look at distruibution and dichotomize hoe it makes more sense: option could be HS, Bachelor, higher
     lang comf: look at distruibution and dichotomize hoe it makes more sense.
     
     
     this is exploratory: use the benjamini correction: test the effects of moderation on model 1a (if covariates don't matter) or 1b (if covariates do matter) = 30 models (say in analysis plan the test of moderation are exploratory and adjustment to p value will be done)
   


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(rio)
library(here)
library(tidyverse)
library(haven)
library(janitor)
library(knitr)
library(surveytoolbox)
library(sjPlot)
library(kableExtra)
library(psych)
library(sjmisc)
library(MVN)

theme_set(theme_minimal())
```


# Loading the dataset (only analysis vars)
```{r}
d <- read_sav(here("data", "d4 - scales & covariates.sav"))

view_df(d)
```


# descriptive stats function
```{r include=FALSE}

# function that takes a df and returns a df with only the numeric columns
only_numeric <- function(df) {
  select_numeric <- dplyr::select_if(df, is.numeric)
  return(select_numeric)
}

# a list with the functions we want
smry <- list(M = function(x) round(mean(x, na.rm = TRUE), 2), 
             SD = function(x) round(sd(x, na.rm = TRUE), 2),
             Min = function(x) round(min(x, na.rm = TRUE), 2),
             Max = function(x) round(max(x, na.rm = TRUE), 2))

# wrapping solution in a function
descriptives <- function(df) {
  select_numeric <- only_numeric(df)
  mean_sd <- map_df(select_numeric, function(col) map_df(smry, ~.x(col)),
       .id = "column")
  return(mean_sd)
}
```


```{r}
only_scales <- d %>%
  select(108:123)

descrip_table <- descriptives(only_scales) %>%
  rename(c("Scale" = "column"))
```


# correlation matrix 
```{r}
library(Hmisc)
rcorr(as.matrix(only_scales), type = "pearson")
```

------------------------------
# RESEARCH QUESTION 2
------------------------------

     model 1a: what is the univar association of each predictor with the outcome (15 models)
     model 1b: what is the multivar assiciation of each predictor with th outcome adjusting for      demo charcs (covariates) (15 models)

# 2.1. Academic approach (tutor)
```{r}
m_hwi_1a <- lm(engage ~ hwi_1, d)
summary(m_hwi_1a) # p = 0.07

m_hwi_1b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + hwi_1, d)
summary(m_hwi_1b) # p = 0.04 (not completely sure if this is the p-value i should look at?)
```

engage predicted by hw1

Intercept: expected value of youth's engagement when the average hW involvement in data set is considered (I think = 2.70)

slope: the effect HW involvement has in youth's engagement = for every one unit increase in HW involvement, youth's engagement increases by 0.15 (but is not significant).

# 2.2. structuring/monitoring approach to HWI
```{r}
m_hwi_2a <- lm(engage ~ hwi_2, d)
summary(m_hwi_2a)# p = 0.01

m_hwi_2b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + hwi_2, d)
summary(m_hwi_2b)# p = 0.01 
```

# 2.3. positive reinforcement to increase HW completion
```{r}
m_hwi_3a <- lm(engage ~ hwi_3, d)
summary(m_hwi_3a) # p = 0.03

m_hwi_3b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + hwi_3, d)
summary(m_hwi_3b) # p = 0.01
```

# 2.4. monitoring
```{r}
m_monit_a <- lm(engage ~ monit, d)
summary(m_monit_a) # p = 0.89

m_monit_a <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + monit, d)
summary(m_monit_a) # p = 0.61
```


# 2.5. structure at home
```{r}
m_str_home_a <- lm(engage ~ str_home, d)
summary(m_str_home_a) # p = 0.04

m_str_home_b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + str_home, d)
summary(m_str_home_b) # p = 0.02
```


# 2.6. convos: child beh & school climate
```{r}
m_convos_1a <- lm(engage ~ convos_1, d)
summary(m_convos_1a) # p = 0.86

m_convos_1b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + convos_1, d)
summary(m_convos_1b) # p = 0.86
```


# 2.7. convos: future career planning
```{r}
m_convos_2a <- lm(engage ~ convos_2, d)
summary(m_convos_2a) # p = 0.07

m_convos_2b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + convos_2, d)
summary(m_convos_2b) # p = 0.14
```


# 2.8. convos: child's social involvement
```{r}
m_convos_3a <- lm(engage ~ convos_3, d)
summary(m_convos_3a) # p = 0.27

m_convos_3b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + convos_3, d)
summary(m_convos_3b) # p = 0.24
```


# 2.9. Basic involvement
```{r}
m_sbi_1a <- lm(engage ~ sbi_1, d)
summary(m_sbi_1a) # p = 0.05

m_sbi_1b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + sbi_1, d)
summary(m_sbi_1b) # p = 0.01
```


# 2.10. Resource-intensive involvement
```{r}
m_sbi_2a <- lm(engage ~ sbi_2, d)
summary(m_sbi_2a) # p = 0.03

m_sbi_2b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + sbi_2, d)
summary(m_sbi_2b) # p = 0.03
```


# 2.11. Belongingness
```{r}
m_belong_a <- lm(engage ~ belong, d)
summary(m_belong_a) # p = 0.97

m_belong_b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + belong, d)
summary(m_belong_b) # p = 0.65
```


# 2.12. Endorsemnt
```{r}
m_endorse_a <- lm(engage ~ endorse, d)
summary(m_endorse_a) # p = 0.53

m_endorse_b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + endorse, d)
summary(m_endorse_b) # p = 0.84
```


# 2.13. Value & supp of Ed
```{r}
m_value_ed_a <- lm(engage ~ value_ed, d)
summary(m_value_ed_a) # p = 0.77

m_value_ed_b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + value_ed, d)
summary(m_value_ed_b) # p = 0.65
```


# 2.14. Rel with teachers: comfort, interest, and openness
```{r}
m_rel_1a <- lm(engage ~ rel_1, d)
summary(m_rel_1a) # p = 0.19

m_rel_1b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + rel_1, d)
summary(m_rel_1b) # p = 0.24
```


# 2.15. Rel with school: parent self-efficacy to solve probs with school
```{r}
m_rel_2a <- lm(engage ~ rel_2, d)
summary(m_rel_2a) # p = 0.66

m_rel_2b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + rel_2, d)
summary(m_rel_2b) # p = 0.41
```

# just for fun: relational aspects predicting parent's self-effi
```{r}
# m_rel_belong <- lm(rel_2 ~ belong, d)
# summary(m_rel_belong) # p < 0.001
# 
# m_rel_endorse <- lm(rel_2 ~ endorse, d)
# summary(m_rel_endorse) # p < 0.001
# 
# m_rel_value_ed <- lm(rel_2 ~ value_ed, d)
# summary(m_rel_value_ed) # p < 0.001
# 
# m_rel_qual <- lm(rel_2 ~ rel_1, d)
# summary(m_rel_qual) # p < 0.001
```


------------------------------
# RESEARCH QUESTION 3
------------------------------

     model 2a: what is the multivar effect of the structural predictors with th outcome (1          model, 10 composire scores simultaneously)
```{r}
m_structs_2a <- lm(engage ~ hwi_1 + hwi_2 + hwi_3 + monit + str_home + convos_1 + convos_2 + convos_3 + sbi_1 + sbi_2, d)
summary(m_structs_2a) # p = 0.09 (full model p-value)
```


     model 2b: what is the multivar effect of the structural predictors with th outcome             adjusting for demo charcr (1 model, 10 composite scores simultaneously + demo vars: block      1 demos, block 2: structural (10 scores))
```{r}
m_structs_2b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + hwi_1 + hwi_2 + hwi_3 + monit + str_home + convos_1 + convos_2 + convos_3 + sbi_1 + sbi_2, d)
summary(m_structs_2b) # p = 0.21 (full model p-value)
```


     model 3a: what is the multivar effect of the relational predictors with th outcome (1          model, 5 composite scores simultaneously)
```{r}
m_rels_3a <- lm(engage ~ belong + endorse + value_ed + rel_1 + rel_2, d)
summary(m_rels_3a) # p = 0.47 (full model p-value)
```


     model 3b: what is the multivar effect of the relational predictors with th outcome             adjusting for demo charcr (1 model, 5 composite scores simultaneously + demo vars: block 1      demos, block 2: relational (5 scores))
```{r}
m_rels_3b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + belong + endorse + value_ed + rel_1 + rel_2, d)
summary(m_rels_3b) # p = 0.58 (full model p-value)
```

      model 4a: what is the multivar effect of structural and relational predictors on the           outcome (1 model,  15 scores simultaneosuly)
```{r}
m_combi_4a <- lm(engage ~ hwi_1 + hwi_2 + hwi_3 + monit + str_home + convos_1 + convos_2 + convos_3 + sbi_1 + sbi_2 + belong + endorse + value_ed + rel_1 + rel_2, d)
summary(m_combi_4a) # p = 0.02 (full model p-value)
```

      
      model 4b: what is the multivar effect of structural and relational predictors on the           outcome adjusting for demo charcr (1 model,  15 scores simultaneosuly + demo vars: block       1 demos, block 2: structural + block 3: relational; if RQ changes and is that interest is       above and beyond structural)
```{r}
# Block 0: demo only
m_demo_4b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel, d)
summary(m_demo_4b) # p = 0.89 (full model p-value)

# Block 1: demo + (combined structural + relational at once)
m_combi_4b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + hwi_1 + hwi_2 + hwi_3 + monit + str_home + convos_1 + convos_2 + convos_3 + sbi_1 + sbi_2 + belong + endorse + value_ed + rel_1 + rel_2, d)
summary(m_combi_4b) # p = 0.06 (full model p-value)
```
# over and above structural 
```{r}
# Block 0: demo only
m_demo_4b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel, d)
summary(m_demo_4b) # p = 0.89 (full model p-value)

# block 1: demo + structural
m_block1_4b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + hwi_1 + hwi_2 + hwi_3 + monit + str_home + convos_1 + convos_2 + convos_3 + sbi_1 + sbi_2, d)
summary(m_block1_4b) # p = 0.21 (full model p-value)

# block 2: demo + structural + relational (over and above structural)
m_block2_4b <- lm(engage ~ parent_role + parent_age + parent_ed + parent_eng_comf + youth_age + youth_gender + youth_grlevel + hwi_1 + hwi_2 + hwi_3 + monit + str_home + convos_1 + convos_2 + convos_3 + sbi_1 + sbi_2 + belong + endorse + value_ed + rel_1 + rel_2, d)
summary(m_block2_4b) # p = 0.06 (full model p-value)
```

     
     
